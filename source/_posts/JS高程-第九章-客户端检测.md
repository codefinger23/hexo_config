---
title: JS高程 第九章 客户端检测
date: 2017-10-30 23:02:10
tags: [读书笔记, JavaScript高级程序设计]
---
> 编写Web程序实际上是为了更加广阔的使用程序，但是，由于不同浏览器，不同平台下的表现各不相同，在这种情况下，客户端检测就作为一个很关键的部分而存在，它决定了我们编写的程序对于不同平台的展现程度，比如想要在低版本的IE浏览器和最新的Chrome浏览器中呈现的程序，往往需要更多的兼容性。
<!--more-->

## 能力检测

能力检测是最为广泛接受的客户端检测方式，又称特性检测，通过检测客户端是否能够支持某一个方法来判断我们接下来的执行脚本的执行状态。采用这种方式不用关心浏览器如何，只要能够支持这个方法，那么我们的脚本就可以执行。

举例来说，IE5之前不支持document.getElementById这个方法，那么我们就可以判断这个方法是否存在，然后再执行代码，这样就可以让我们之后的脚本正常执行。

需要注意的一点是，浏览器对这个特性的支持可能不符合我们的预期，比如我们希望的document.getElementById方法是一个函数，但是可能在某个浏览器中它是以属性的形式存在的，所以单纯的判断是否存在是不够的，还需要typeof操作符来判断这个属性是不是函数。

## 怪癖检测

怪癖检测实际上就是bug检测，在使用这个方式时，我们预期的目标是判断出浏览器是否存在某些和我们预期不一致的行为。

举个例子来说，Safari3通过for-in会枚举出不可枚举的属性，和我们的预期不一样，这时我们可以通过预执行代码来判断结果是否符合预期。

## 用户代理检测

用户代理检测实际上是最不靠谱的检测方式，浏览器在发送给服务器时，会自动添加一个header，键值是userAgent，属性是一端特殊的字符串，这个字符串可能是包含渲染引擎，浏览器版本，支持的平台，是否加密等信息组成的字符串，正是由于这种方式的存在，导致浏览器可以进行伪装，它可以发送任意的字符串给服务器，以便能够支持这个站点。

HTTP规范中明确规定，浏览器应当发送简短的用户代理字符串，指明浏览器的名称和版本号，RFC2616即HTTP1.1规范中是这样描述用户代理字符串的

> 产品标识符常用于通信应用程序标识自身，由软件名和版本组成，使用产品标识符的大多数领域也允许列出作为应用程序主要部分的子产品，由空格分隔。按照惯例，产品要按照相应的重要程度依次列出，以便标识应用程序

经过很长一段时间的发展，这个规范虽然还在发挥着作用，但是已经被各个浏览器厂商破坏的面目全非，具体的可以看下浏览器的发展史，因为浏览器的厂商肯定是要自己的浏览器能够支持流行的站点，也在标识符中添加了自己定义的属性，因此通过用户代理检测客户端是相当不靠谱的。

## 小结

本章内容主要是客户端检测，主要使用是保证自己的代码能够最大程度的适用于不同的浏览器。存在很多客户端检测的方法，最主要的检测方式有以下几种：

- 能力检测：在编写代码前，判断客户端是否具备执行某一函数的能力。与客户端的版本和平台无关，能够让开发者更多的关注与实现。
- 怪癖检测：通过预执行脚本，确定客户端是否存在某些缺陷，避免后续的脚本出现问题，在效率上存在问题，同样不能检测出具体的客户端类型。
- 用户代理检测：通过用户代理信息的解析，确认具体的浏览器和版本，因为用户代理信息可以伪造，俗称电子欺诈，所以这种方式是最不靠谱的。但是在某些情况下，如不能直接进行能力检测和怪癖检测，或用于跟踪分析来确定用户行为。这些情况下必须确定具体的浏览器版本。

在决定使用哪种客户端检测方式时，有限选择能力检测，其次是怪癖检测，最后才是用户代理检测，因为这种方式严重依赖用户提供的用户代理信息，不靠谱。
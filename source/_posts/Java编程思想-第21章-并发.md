---
title: Java编程思想 第21章 并发
date: 2017-12-06 23:24:13
tags: [读书笔记, Java编程思想]
---
> 到目前为止，学习到的都是顺序编程的知识。即程序中的所有事物在任意时刻都只能执行一个步骤。

<!--more-->

## 并发的多面性

并发编程令人困惑的一个主要原因是：使用并发时需要解决的问题有多个，而实现并发的方式也有多种，并且在这两者之间没有明显的映射关系。

- 更快的执行
- 改进代码设计

## 基本的线程机制

并发编程可以将程序划分为多个分离的、独立运行的任务。通过使用多线程机制，这些独立任务中的每一个都将由执行线程来驱动。一个线程就是在进程中的一个单一的顺序控制流，因此，单个进程可以拥有多个并发执行的任务，但是程序使得每个人物都好像有其自己的CPU一样。其底层机制是切分CPU时间。

- 定义任务：通过实现Runnable接口并编写run方法，使得该任务可以执行命令。
- Thread类：将Runnable对象转变为工作任务的传统方式是把它提交给一个Thread构造器。调用Thread对象的start方法为该线程执行必须的初始化操作，然后调用Runnable的run方法启动任务。
- 使用Executor：执行器可以管理Thread对象，从而简化并发编程。
- 从任务中产生返回值：如果希望任务在完成时能够返回一个值，那么可以实现Callable接口而不是Runnable接口。
- 休眠：影响任务行为的一种简单方式是调用sleep。
- 优先级：线程的优先级将该线程的重要性传递给了调度器。尽管CPU处理现有线程集的顺序是不确定的，但是调度器将倾向于让优先权最高的线程先执行。
- 让步：通过yield方法可以让线程调度机制知道该线程以工作得差不多了。
- 后台线程：所谓后台线程，是指在程序运行的时候在后台提供一种通用服务的线程，并且这种线程并不属于程序中不可或缺的部分。

## 共享受限资源

可以把单线程程序当作在问题域求解的单一实体。多线程会导致冲突问题。

- 不正确地访问资源
- 解决共享资源竞争
- 原子性和易变性
- 原子类
- 临界区
- 在其他对象上同步
- 线程本地存储

## 终结任务

cancel和isCanceled方法被放到了一个所有任务都可以看到的类中。这些任务通过检查isCanceled来确定合适终止自己。

## 线程之间的协作

当使用线程同时运行多个任务时，可以通过使用锁来同步两个任务的行为，从而使得一个任务不会干涉另一个任务的资源。

## 死锁

一个对象可以有synchronized方法或其他形式的枷锁机制来防止别的任务在互斥还没有释放的时候就访问这个对象。任务可以变成阻塞状态，容易造成死锁问题。

## 仿真

并发最有趣的也最令人兴奋的用法就是创建仿真。通过使用并发，仿真的每个构件都可以成为其自身的任务。

## 性能调优

在Java SE5的java.util.concurrent类库中存在着数量庞大的用于性能提高的类。

## 活动对象

Java中的线程机制看起来非常复杂并难以正确使用。有一种可替换的方式被称为活动对象或行动者。

## 总结

多线程的主要缺陷有：

1. 等待共享资源的时候性能降低
2. 需要处理线程的额外CPU话费
3. 糟糕的程序设计导致不必要的复杂度
4. 有可能产生一些病态行为，如饿死、竞争、死锁和活锁。
5. 不同平台导致的不一致性。

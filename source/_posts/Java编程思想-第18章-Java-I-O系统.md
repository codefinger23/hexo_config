---
title: Java编程思想 第18章 Java I/O系统
date: 2017-12-03 17:08:47
tags: [读书笔记, Java编程思想]
---
> 对程序语言的设计者来说，创建一个好的输入/输出(I/O)系统是一项艰难的任务。
<!--more-->
## File类

File类整个名字有一定的误导性；它既能代表一个特定文件的名称，又能代表一个目录下的一组文件的名称。如果它指的是一个文件集，就可以调用list方法，这个方法会返回一个字符数组。如果想取得不同的目录列表，只需要再创建一个不同的File对象就可以了。

## 输入和输出

编程语言的I/O类库中常使用流这个抽象概念，它代表任何有能力产出数据的数据源对象或者是有能力接收数据的接收端对象。“流”屏蔽了实际的I/O设备中处理数据的细节。

Java类库中I/O类分成输入和输出两部分，可以再JDK文档里的类层次结构中查看到。通过继承，任何Inputstream或Reader派生而来的类都包含read的基本方法，用于读取单个字节或者字节数组。同样，任何自OuputStream或Writer派生而来的类都含有名为write的基本方法，用于写单个字节或者字节数组。通常很少使用单一的类来创建流对象，而是通过叠合多个对象来提供所期望的功能。

## 添加属性和有用的接口

装饰器再第15章引入。Java I/O类库需要多种不同功能的组合，这正式使用装饰器模式的理由所在。这也是Java I/O类库里存在filter类的原因所在，抽象类filter是所有装饰器类的基类。装饰器必须具有和它所装饰的对象相同的接口，但它也可以扩展接口，而这种情况只发生在个别filter类中。

## Reader和Writer

Java 1.1对基本的I/O流类库进行了重大的修改。设计Reader和Writer继承层次接口主要是为了国际化。老的I/O流继承层次结构仅支持8位字节流，并且不能很好地处理16位的Unicode字符。由于Unicode用于字符国际化，所以添加Reader和Writer继承层次结构就是为了在所有的I/O操作中都支持Unicode。另外，新类库的设计使得它的操作比旧类库更快。

## 自我独立的类：RandomAccessFile

RandomAccessFile适用于由大小已知的记录组成的文件，所以可以使用seek将记录从一处转移到另一处，然后读取或者修改记录。文件中记录的大小不一定都相同，只要能够确定那些记录有多大以及它们在文件中的位置即可。

## I/O流的典型使用方式

尽管可以通过不同的方式组合I/O流类，但可能也就只用到其中的几种组合。

- 缓冲输入文件
- 从内存输入
- 格式化的内存输入
- 基本文件输出
- 存储和恢复数据
- 读写随机访问文件
- 管道流

## 文件读写的实用工具

一个很常见的程序化任务就是读取文件到内存，修改，然后再写出。Java I/O类库的问题之一就是：它需要编写相当多的代码去执行这些常用操作——没有任何基本的帮助功能可以做这一切。因此可以添加帮助类就显得更有意义。

## 标准I/O

标准I/O这个术语参考的是Unix中“程序所使用的单一信息流”这个概念。程序的所有输入都可以来自标准输入，它的所有输出也都可以发送到标准输出，以及所有的错误信息都可以发送到标准错误。标准I/O的意义在于：可以很容易地把程序串联起来，一个程序的标准输出可以称为另一程序的标准输入。

- 从标准输入中读取
- 将System.out转换成PrintWriter
- 标准I/O重定向

## 进程控制

如果需要再Java内部执行其他操作系统的程序，并且要控制这些程序的输入和输出。Java类库提供了执行这些操作的类。

## 新I/O

JDK 1.4的java.nio.*包中引入了新的Java I/O类库，其目的在于提高速度。实际上，旧的I/O包已经使用nio重新实现过，以便充分利用这种速度提高，因此，即使不显示地用nio编写代码，也能从中受益。速度的提高在文件I/O和网络I/O中都有可能发生。

## 压缩

Java I/O类库中的类支持读写压缩格式的数据流。可以用它们对其他的I/O类进行封装，以提供压缩功能。

- 用GZIP进行简单压缩
- 用Zip进行多文件保存
- Java档案文件

## 对象序列化

Java的对象序列化将那些实现了Serializable接口的对象转换成一个字节序列，并能够在以后将这个字节序列完全恢复为原来的对象。这一过程甚至可通过网络进行；这意味着序列化机制能自动弥补不同操作系统之间的差异。

## XML

对象序列化的一个重要限制是它只是java的解决方案：只有Java程序才能反序列化这种对象。一种更具互操作性的解决方案是将数据转换为XML格式，这可以使其被各种各样的平台和语言使用。

## Preferences

Preferences API与对象序列化相比，前者与对象持久化性更密切，因为它可以自动存储和读取信息。不过它只能用于小的、受限的数据集合——只能存储基本类型和字符串，并且每个字符串的存储长度不能超过8K。所以，Preferences API用于存储和读取用户的偏好以及程序配置项的设置。

## 总结

Java I/O流类库的确能满足基本需求：可以通过控制台、文件、内存块，甚至因特网进行读写。通过继承，可以创建新类型的输入和输出对象。并且通过重新定义toString方法，甚至可以对流接受的对象类型进行简单扩充。向一个期望收到字符串的方法传送一个对象时，会自动调用toString犯法，这是Java有限的自动类型转换功能。
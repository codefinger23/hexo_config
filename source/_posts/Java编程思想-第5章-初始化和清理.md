---
title: Java编程思想 第5章 初始化和清理
date: 2017-11-20 22:43:25
tags: [读书笔记, Java编程思想]
---
> 随着计算机革命的发展，不安全的编程方式已逐渐称为编程代价高昂的主因之一
<!--more-->
## 用构造器确保初始化

Java和C++的设计相同，构造器与类的名称相同。构造器是由编译器调用的。不接受任何参数的构造器叫做默认构造器。Java文档中通常使用术语无参构造器。构造器是一种特殊类型的方法，因为它没有返回值。

## 方法重载

Java可以支持对方法的重载，可以允许声明相同的方法，但是不同方法必须用参数的不同加以区分，甚至不同的参数顺序都可以用来作为重载方法的区分，不鼓励这种写法，因为这会使代码难以维护。

## 默认构造器

如果创建的类没有创建构造器，那么编译器就会自动创建一个默认构造器，如果创建了构造器，即必须使用相应的构造函数来创建对象。

## this关键字

编译器在每个方法都会默认增加一个指向当前对象的引用类型，因为使编译器自动添加的，所以有一个默认的名字，this，可以用来调用当前对象的属性和方法。

## 清理：终结处理和垃圾回收

Java的垃圾回收只能回收new出来的对象，但是程序中仍然会存在非new调用的内存，比如文件句柄或者用本地方法分配的内存，这是需要用finalize方法来判断终结条件。

- 对象可能不被垃圾回收
- 垃圾回收并不等于析构
- 垃圾回收只与内存有关

垃圾回收器的方式最简单的就是引用计数，但是因为存在循环引用问题，所以通常是用来说明垃圾回收的方式，并没有真正使用这种垃圾回收方式。

正常的垃圾回收思想是：对任何活的对象，一定嗯那个最终追溯到其存活在栈空间或静态存储区之中的引用。这个引用链条可能会穿过数个对象层次。由此，如果从栈和静态存储区开始，遍历所有的引用，就能找到所有活的对象。而没有发现的对象，就是可以被回收的内存。

Java虚拟机采用一种自适应的垃圾回收技术。有一种做法名为停止-复制。即先暂停程序的运行，然后将所有存活的对象从当前堆复制到另一堆，没有被复制的全部都是垃圾。当对象被复制到新堆时，它们时一个挨着一个的，也就完成了内存的重排。

这种复制式回收器效率相当低，因此有另外一种标记-清扫方式，还是采用从栈和静态存储区出发，遍历所有引用的方式来找到所有存活的对象，对每个活的对象进行标记，只有当标记工作完成时，清理动作才会开始。但是标记-清扫工作也必须在程序暂停的情况下进行。

## 成员初始化

Java尽力保证：所有变量在使用前都能得到恰当的初始化。对于方法的局部变量，Java以编译时错误的形式来贯彻保证。

## 构造器初始化

可以采用构造器来进行初始化。在运行时刻，可以调用方法或执行某些动作来确定初值，这为编程带来更大的灵活性。

## 数组初始化

数组只是相同类型的、用一个标识符封装到一起的一个对象序列或基本类型数据序列。数组时通过方括号下标操作符[]来定义和使用的。

通过Object数组可以令函数支持可变参数列表，另外一种，也是更加通用的支持可变参数的方式Object ... args，有了可变参数，就再也不用显式地编写数组语法。

## 枚举类型

Java SE5添加了一个enum关键字，它使得再需要数组并使用枚举类型集时，可以很方便地处理。同时，enum可以配合switch的case使用。

## 总结

Java的构造器能够保证正确的初始化和清理，如果没有正确的构造器调用，编译器就不允许创建对象。

由于Java有垃圾回收机制，所以并没有析构函数，然而垃圾回收器确实也增加了运行时的开销。
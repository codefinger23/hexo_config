---
title: JS高程 第23章 离线应用与客户端存储
date: 2017-11-13 23:41:46
tags: [读书笔记, JavaScript高级程序设计]
---
> 支持离线Web应用开发时HTML5的另一个重点。所谓离线Web应用，就是在设备不能上网的情况下仍然可以运行的应用。HTML5把离线应用作为重点，主要基于开发人员的心愿。前端开发人员一直希望Web应用能够与传统的客户端应用通常竞技，起码做到只要设备有电就能使用。

<!--more-->

## 离线检测

开发离线应用的第一步是要知道设备是在线还是离线，HTML5为此定义了一个navigator.onLine属性，这个属性值为true表示设备能上网，值为false表示设备离线。这个属性的关键是浏览器必须知道设备能够访问网络，从而返回正确的值。

## 应用缓存

HTML5的应用缓存(application cache)，或者简称为appcache，是专门为开发离线Web应用而设计的。Appcache就是从浏览器的缓存中分出来的一块缓存区。要想在这个缓存中保存数据，可以使用一个描述文件(manifest file)，列出要下载和缓存的资源。

## 数据存储

随着Web应用程序的出现，也产生了对于能够直接在客户端上存储用户信息能力的要求。想法很合乎逻辑，属于某个特定用户的信息应该存在该用户的机器上。无论是登录信息、偏好设定或其他数据，Web应用提供者发现他们在找各种方式将存在客户端上。这个问题的第一个方案是以cookie的形式出现的。今天，cookie只是在客户端存储数据的其中一种方式。

- Cookie：HTTP Cookie，通常直接叫做cookie，最初是在客户端用于存储会话信息。该标准要求服务器对任意HTTP请求发送Set-Cookie HTTP头作为响应的一部分，其中包含会话信息。
- IE用户数据：在IE5.0中，微软通过一个自定义行为引入了持久化用户数据的概念。用户数据允许每个文档最多128KB数据，每个域名最多1MB数据。
- Web存储机制：Web Storage最早是在Web超文本应用技术工作组(WHAT-WG)的Web应用1.0规范中描述的。这个规范的最初的工作最终成为了HTML5的一部分。Web Storage的目的是客户由cookie带来的一些限制，当数据需要被严格控制在客户端上时，无须持续地将数据发回服务器。Web Storage的两个主要目标是：提供一种在cookie之外存储会话数据的途径；提供一种存储大量可以跨会话存在的数据的机制。
- IndexedDB：Indexed Database API，或者简称为IndexedDB，是在浏览器中保存结构化数据的一种数据库。IndexedDB的思想是创建一套API，方便保存和读取JavaScript对象，同时还支持查询及搜索。IndexedDB设计的操作完全是异步进行的。因此，大多数操作会以请求方式进行，但这些操作会在后期执行，然后如果成功返回结果，如果失败则返回错误。差不多每一次IndexedDB操作，都需要你注册onerror或onsuccess事件处理程序，以确保适当地处理结果。

## 小结

离线Web应用和客户端存储数据的能力对未来的Web应用越来越重要。浏览器已经能够检测到用户是否离线，并触发JavaScript事件以便应用做出处理。可以指定个在应用缓存中保存哪些文件以便离线时使用。对于应用缓存的状态及变化，也有相应的JavaScriptAPI可以调用检测。
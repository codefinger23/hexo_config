---
title: JS高程 第十章 DOM
date: 2017-10-31 22:30:32
tags: [读书笔记, JavaScript高级程序设计]
---
> 文档对象模型(DOM)是针对HTML或XML文档的一个API。DOM描绘了一个层次化的节点树，允许开发人员通过操作DOM，对文档内容进行编辑，是实现动态页面的一个关键组成部分

<!--more-->

## 节点层次

DOM可以将任意的HTML或XML文档描绘成一个层次化的节点树。节点分为不同的类型，每种类型表示文档中不同的信息和标记。每个节点都有各自的特点、数据和方法，另外也和其他节点存在某种关系。所有的页面标记表现为一个特定的节点为根节点的树形结构。以下面的HTML代码为例

```
<html>
    <head>
        <title>Sample Page</title>
    </head>
    <body>
        <p>Hello World!</p>
    </body>
</html>
```

上述代码的层次结构如图所示：

![](https://codefinger.cn/wp-content/uploads/2017/10/Screen-Shot-2017-10-31-at-22.37.49.png)

文档节点是每个文档的根节点，在这个例子中，文档节点只有一个字节点，即<html>元素，我们称之为文档元素。文档元素是所有元素的最外层元素，文档中的其他元素都包括在文档元素中。每个文档都只能有一个文档元素，在HTML文档中，文档元素始终是<html>元素。在XML文档中，没有预定义的元素，因此任何元素都能成为文档元素。

### Node类型

DOM1级定义了一个Node接口，该接口由其他所有DOM的节点实现。这个Node接口在JavaScript中是作为Node类型实现的。JavaScript中的所有节点都继承自Node类型，因此所有节点都共享着相同的基本属性和方法。

每个节点都有一个nodeType属性，用来表明节点的类型。节点类型由在Node类型中定义的12个数值常数表示，任何节点类型必居其一：

- Node.ELEMENT_NODE(1): 元素节点类型，任何html元素都属于元素节点类型，可以有任意数量的子节点。
- Node.ATTRIBUTE_NODE(2): 特性节点类型，通常用来表示元素节点的特性列表，没有子节点。
- Node.TEXT_NODE(3): 文本节点，用来保存显示文本的节点，相邻的文本节点可以通过normalize方法合并成一个文档节点，也可以通过split方法拆分成两个节点，保存在文本节点中的字符串会被HTML格式化，特殊字符会进行转义，没有子节点。
- Node.CDATA_SECTION_NODE(4): CDATA节点，主要使用于XML文档中国年，用来表示CDATA属性。
- Node.ENTITY_REFERENCE_NODE(5): 实体引用节点，书中没有做解释，不清楚具体情况。
- Node.ENTITY_NODE(6): 同上，书中没有做解释。
- Node.PROCESSING_INSTRUCTION_NODE(7): 同上
- Node.COMMENT_NODE(8): 注释节点，表示文档中的注释，以<!-- -->形式存在
- Node.DOCUMENT_NODE(9): 文档节点，根节点属性，只有一个字节点，即文档元素
- Node.DOCUMENT_TYPE_NODE(10): 文档类型节点，最常见的就是HTML5的文档类型声明，将会作为一个独立的节点存在，用来快速判断文档类型，诶呦字节点。
- Node.DOCUMENT_FRAGMENT_NODE(11): 文档片段节点，可以避免文档节点重复渲染，是一个独立的节点。其内容不会展示在文档内容中。
- Node.NOTATION_NODE(12): 同上

通过上面的常量就可以判断出节点的属性，一般通过nodeType属性与数字值进行比较来判断文档类型，一般使用于整体格式化文档内容时，对于不同的节点进行不同的操作时使用。

节点关系主要有父子关系和同胞关系，父节点可以通过childNodes属性访问所有的子节点，保存在一个动态的NodeList对象中，所谓动态，是因为每次调用这个对象时都会实时获取当时的属性值，一旦发生变化就会实时显示出来。

下图表示出所有的关系获取，包括父子关系和同胞关系：

![](https://codefinger.cn/wp-content/uploads/2017/10/Screen-Shot-2017-10-31-at-23.02.48.png)

另外还有一些获取节点的方法，这里主要介绍两个：

- getElementById: 通过id属性查询目标节点，id区分大小写，返回一个指向该节点的一个引用，如果有重复id，那么返回第一个匹配的节点，可以直接操作该节点。
- getElementByTagName: 通过标签名获得文档中所有传入参数标签的节点，返回一个HTMLCollection对象，和 NodeList对象类似，也是动态的数据集，每一次调用都将进行一次查询，通过传入参数"*"可以获得文档中所有的元素。

### 操作节点

关系指针是只读的，因此需要其他方法来对文档进行操作，主要有一下几种：

- appendChild: 向当前节点的childNodes添加一个新的节点，当然只要当前节点有子节点的情况下才可以，否则就会报错。
- insertChild: 向指定节点前插入节点，如果指定节点为null，则效果与appendChild效果相同。
- replaceChild: 替换指定节点，被替换的节点仍然为文档所有，但是在文档中没有它的位置。
- removeChild: 移除指定节点，同样，被删除的节点仍然为文档所有，只不过在文档中没有它的位置，也就是不会显示出来。

上述操作文档的方法，都会在文档中直接的显示出结果。

## DOM操作技术

一般还是推荐直接写HTML代码而不是通过DOM来操作，但是有些情况下是必须的，比如动态的展示页面内容。

### 动态脚本

有时候我们不想在页面最开始加载一段script代码，然后我们就可以想到，<javascript>标签也是文档元素，也就可以通过操作DOM的手段来手动添加JavaScript代码，在需要的时候加载我们需要的JavaScript代码，这种方式能大大加快页面响应速度。

### 动态样式

和动态脚本类似，通过操作DOM，在需要的时候，通过操作DOM的方式加载样式表，渲染需要的元素，同样能够加快页面响应，需要注意的是，这种方式会增加运行负载，因为浏览器可能需要更多的计算资源来进行渲染。

## 小结

本章内容其实有很多，原文中对每个节点类型都进行了大篇幅的描述，因为大部分内容都是对各个浏览器的兼容描述，所以在转述的时候没有提及，主要内容就是DOM将文档标注为一个层次化的节点树，同时DOM实际上是语言无关的中立API，任何语言都可以操作DOM，只不过在JavaScirpt中，显得更加依赖而已

- 最基本的节点类型是Node，所有的其他节点都继承自Node。
- document对象是Document类型的实例，通过document对象可以查询和操作节点。
- Element类型的节点是HTML和XML中的所有元素，可以通过操作元素节点来改变文档的基本属性。

理解DOM的关键，就是DOM对性能的影响。DOM操作往往是JavaScript中开销最大的部分，主要是对NodeList对象的访问，因为NodeList是动态的，因此每一次访问都讲对文档所有内容进行一次查询。因此，尽可能的减少DOM操作是性能提升的重要部分。
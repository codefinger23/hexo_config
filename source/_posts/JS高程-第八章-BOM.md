---
title: JS高程 第八章 BOM
date: 2017-10-29 21:08:19
tags: [读书笔记, JavaScript高级程序设计]
---
> 本章介绍了JavaScript的另一个组成部分，浏览器对象模型BOM，BOM可以视为浏览器提供给JavaScript脚本的应用接口，使JavaScript具备了调用浏览器实现某些功能的能力，然而为了安全，大部分浏览器都禁用了其中的某些功能。BOM目前缺少共有的规范，浏览器的提供厂商会任性的添加自以为很awsome的功能，因此，W3C为了把浏览器中JavaScript最基本的部分标准化，已经将BOM的主要方面纳入了HTML5的规范中。
<!--more-->

## window对象

在讲述ECMAScript时，提到了一个全局的Global对象，再编写实际的脚本时，这个对象是不存在的，因此，充当这个功能的实际对象就是window对象，因此，再全局中定义的任何变量，方法和对象，window对象都有权访问。window对象实际上就是一个浏览器窗口的实例，每个窗口都有自己的window对象。

### 全局作用域

因为window对象是Global对象的化身，因此在全局中定义的任何对象，变量都会变成window的属性，但是需要注意一点

> 声明为全局的变量不可以通过delete删除，但是声明为window对象的方法却可以。

本章后续其他的对象，其实都是window对象的属性。

### 窗口及框架

如果页面中包含框架，即frame引入的页面，那么每个框架都有自己的window对象，因为他们也可以视为一个浏览器窗口实例，他们的window对象保存在父window对象的frames集合，通过数值索引(从0开始)可以访问这些框架，或者通过框架名称来访问，也就是frame的name属性。

```
window.frames[0]
```

通过上述代码可以访问当前窗口的第一个框架内的窗口对象，另外，最好是通过top对象而非window对象来调用框架窗口对象，因为对于脚本代码来说，window对象总是意味着当前所在的窗口，而非最上层，为了避免歧义，最好是像下面这样使用。

```
top.frames[0]
```

如果框架中包含框架，那么使用parent属性可以访问其父框架的窗口，最上层的parent和top也就是最上层的window对象是等价的，也就是指向同一个对象。

### 窗口位置

通过screenLeft和screenRight属性，在firefox中是screenX和screenY来获得窗口的位置信息，分别表示窗口距离屏幕左边和屏幕上边的距离。

这两个方法可能被浏览器禁用，有些浏览器默认就禁用这两个属性。另外这两个属性都不适用于框架，只适用于最外层的window对象。

### 窗口大小

判断窗口大小并不是一件简单的事情，一些浏览器提供了4个属性，innerWidth,innerHeight,outerWidth,outerHeight。outerWidth与outerHeight返回浏览器窗口的大小，innerWidth与innerHeight返回页面视图容器的大小(减去边框的大小)。

IE8及更早期的版本没有提供取得浏览器窗口尺寸的属性，但是，它通过DOM提供了页面可见区域的相关信息。

document.documentElement.clientWidth和document.documentElement.clientHeight表明了页面视图的大小。这些属性必须在标准模式下才有效；如果是混杂模式就必须通过document.body.clientWidth和document.body.clientHeight来获取。

使用resizeTo和resizeBy两个方法可以调整浏览器的大小，resizeTo接收的参数是新浏览器的大小，resizeBy是新浏览器与原浏览器的大小差。

与移动窗口类似，这两个方法也是会被浏览器禁用；同时也不适用于框架，只能被最外层window对象使用。

### 导航和打开窗口

window.open可以导航到一个特定的窗口，也可以打开一个新的浏览器窗口。它接收4个参数：要加载的URL、窗口目标、一个特性字符串、以及一个新页面是否替代历史记录中当前页面的布尔值。通常指传输一个参数，当不打开新的窗口时才传入最后一个参数。

- 传输了第二个参数，而且该参数是已有的窗口或框架的名称，则会在指定的窗口或框架中加载特定的URL窗口。

- 如果第二个参数不是以存在的窗口或框架，那么该方法就会通过第三个参数传入的字符串新的窗口或新标签页。第三个参数是一个逗号分割的指定字符串。具体属性自查。

- 使用close方法可以关闭打开的窗口。

- 有些浏览器会在独立的进程中运行新的标签页，但是当两个窗口要通信时，就不能在独立的进程中运行新的窗口，每一个新创建的窗口都有一个opener属性，指向打开它的窗口，如果主动断开这个属性，那么新窗口就会在独立进程中运行。

- 为了避免广告商滥用弹窗，打开窗口的方法受到了极大的限制，可以通过安装插件的方式屏蔽掉弹出的窗口，有些浏览器也自带屏蔽功能。

### 间歇调用和超时调用

JavaScript时单线程语言，但它允许设置超时值和间歇时间值来调度代码在指定的时间运行。

- 超时调用使用setTimeout方法，该方法接受一个数值参数，表示数值毫秒后运行的代码，该代码可以是eval类似的JavaScript代码字符串，为了提高性能，通常是通过函数调用的方式指定执行的方法。
- 超时调用的弊端在于，设置了超时时间，到了时间指定的程序却未必会运行，因为JavaScript是单线程解释器，因此一定时间内只能执行一段代码，为了控制要执行的代码，就有一个JavaScript执行队列，这些任务会按照其在执行队列中的顺序执行，setTimeout实际上就是指定时间后将任务放入队列，当队列为空时，任务会立刻执行，当队列不为空时，任务会添加到队列尾。直到它执行。
- setTimeout就返回一个任务ID，通过这个ID，clearTimeout可以在超时调用没有执行前取消掉超时调用。
- 间歇调用会按照指定的时间间隔重复执行任务，使用setInterval设置运行任务的毫秒时间间隔。直到任务取消或页面被卸载才会停止。
- setInterval同样返回一个ID，可以通过clearInterval取消间歇调用。

### 系统对话框

浏览器可以通过alert,confirm,prompt调用系统对话框向用户显示信息。它们的外观由操作系统及浏览器设置决定，与CSS和HTML无关。通过这几个方法弹出对话框是同步和模态的，也就是说，显示这几个对话框时，脚本将停止运行，直到用户关掉对话框。

- alert方法通常用来弹出警告，用户在看到信息后只能选择关掉。
- confirm方法与alert方法不同之处在于不仅提供确认按钮，还提供了取消按钮，可以通过用户不同的点击来进行不同的方法，如确认删除。
- prompt是confirm的强化，不仅提供两个按钮，还提供了文本输入，或许用户的一些输入值，如我们在访问ftp网站时弹出的用户密码输入。

另外还有两个JavaScript可以打开的对话框，查找和打印,find和print方法。这两个方法是异步的，不会阻塞代码的运行，不会被对话框计数器统计，因此也不会被禁用后续对话框禁用。

## location对象

location对象提供了当前窗口加载的文档的相关信息，还提供一些导航功能，location对象是一个特别的对象，因为他是window和document共有对象，也就是window.location和document.location指向的是同一个对象，location对象将URL解析为独立的片段，如hash,host,hostname,href,pathname,port,protocol,search。

### 查询字符串参数

location对象的查询字符串参数提供的是一整个查询字符串，而不能提供其中的某一个属性，因此需要我们自己解析。

### 位置操作

浏览器所谓的位置，不同于窗口位置，而是资源位置，也就是通过URL指定的资源位置，通过assign改变浏览器位置。如果为location.href和window.location设置一个新的URL值，与通过assgn方法达到的效果是相同的。也可以通过重新设置host,hostname,port设置浏览器位置。

通过上述任意方法修改URL后，都会在浏览器的历史记录中生成一条历史记录，可以通过后退按钮回到上一个页面，如果要禁用这种行为，可以通过replace方法禁用这种行为这样用户就不能回到上一个页面。。

通过reload方法可以重新加载页面，如果请求没有改变过，则会在浏览器缓存中加载页面，通过传递true参数，可以强制浏览器从服务器重新加载页面。

## navigtor对象

navigtor是用来识别客户端的对象，每个浏览器都有自己的navigtor属性，但是有些是共有的属性，如下图所示，列出了存在于浏览器的共有方法和属性及支持它们的浏览器版本。

![](https://codefinger.cn/wp-content/uploads/2017/10/Screen-Shot-2017-10-29-at-22.19.11.png)
![](https://codefinger.cn/wp-content/uploads/2017/10/Screen-Shot-2017-10-29-at-22.19.24.png)

### 检测插件

对于非IE浏览器，可以通过plugins数组检测是否安装指定插件，该数组的每一项都包含name,description,filename三项属性，通过迭代plugins数组可以判断出浏览器安装的所有插件，也可以通过hasPlugin函数来判断是否安装某一个具体的属性。

对于IE浏览器，只能通过ActiveXObject来判断是否具有某一插件的实例。IE是以COM的方式实现插件的，而COM使用唯一标识符来标识，因此要检测特定的插件，就必须知道其COM标识符。

### 注册处理程序

Firefox2 为navigator对象新增了registerContentHandler和registerProtocalHandler来让一个站点指明它可以处理的特定类型，如RSS阅读器和在线电子邮件程序。

 ## screen对象

 JavaScript中有几个对象在编程中用处不大，而screen就是其中之一，其实也并不是完全无关，有些显示上的功能还是很需要screen对象的。它只用来表示浏览器窗口外部的显示器信息，如像素宽度和高度。

 ## history对象

 history对象保存着对象的浏览历史，从用户打开浏览器开始记录。因为history对象是window对象的属性，因此每一个窗口，标签页或者框架，都有自己的history对象。出于安全考虑，开发人员无法得知用户浏览过的URL，但是可以通过在history对象中的位置来实现后退和前进。

 go方法可以在历史记录中任意跳转。正数表示向前跳转，负数表示向后跳转。同时也可以传入一个字符串参数，跳到历史记录中包含该字符串最近的那一条历史记录，可能向前，也可能向后。

 使用back和forward来简化go方法，简单的后退和向前功能，可以理解为两个栈模拟的，一个后退栈一个向前栈，如果访问了新的窗口，则将向前栈置空。

 ## 小结

 浏览器对象模型(BOM)以window对象为依托，表示页面窗口及可见区域。同时window对象和兼任ECMAScript中的Global对象，因此全局的对象和属性都是它的对象和属性。

 - 使用框架frame时，每个框架都有自己的window对象，每个框架都保存在frames数组中，可以通过位置或名称来访问
- 一些窗口指针可以用来访问其他窗口，包括父窗口
- top对象指向最外层的浏览器对象
- parent对象指向父框架，self指向自身window，当处于最外层时，parent和self等价
- 使用location对象可以通过编程方式改变浏览器的导航系统。
- 调用replace方法可以导航到一个新的URL，同时该URL会替换历史记录中的当前显示页面，无法后退到当前显示页面
- navigator对象提供了浏览器的相关信息。到底提供哪些信息取决于浏览器类型和版本，但是也有些公共的属性如userAgent存在于所有的浏览器中。

BOM的另外两个对象: screen和history，但是它们功能有限。screen对象保存客户端显示器的相关信息，一般用来做站点分析。history对象提供了有限的访问历史记录的方法，开发者可以在历史记录中导航到任意位置。
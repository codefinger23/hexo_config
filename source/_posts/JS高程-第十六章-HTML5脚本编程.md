---
title: JS高程 第十六章 HTML5脚本编程
date: 2017-11-06 22:56:54
tags: [读书笔记, JavaScript高级程序设计]
---

> HTML5除了对DOM进行了扩展，也定义了很多新HTML标记。为了配合这些标记的变化，HTML5规范也用显著蝙蝠定义了很多JavaScript API。定义这些API的用意就是简化此前实现起来苦难重重的人物，最终简化创建动态Web界面的工作。

<!--more-->

## 跨文档消息传递

跨文档消息传送(cross-document messageing)，有时候建成为XDM，指的是在来自不同域的页面间传递消息。在XDM机制出现之前，要稳妥地实现这种通信需要花很多功夫。XDM把这种机制规范化，让我们能既稳妥又简单地实现跨文档通信。

XDM的核心是postMessage方法。在HTML5规范中，除了XDM不否认之外的其他部分也会提到这个方法名，但都是为了同一个目的：向另一个地方传递数据。对于XDM而言，“另一个地方”指的是包含在当前页面中的iframe元素，或者由当前页面弹出的窗口。

postMessage方法接收两个参数：一套消息和一个表示消息接收方来自那个域的字符串。

## 原生拖放

最早在网页中引入JavaScript拖放功能的是IE4.当时，网页中只有两种对象可以拖放：图像和某些文本。拖放图像时，把鼠标放在图像上，按住鼠标不放就可以拖动他。拖动文本时，要先选中文本，然后可以像拖动图像一样拖动被选中的饿文本。在IE4中，唯一有效的放置目标是文本框。到了IE5，拖放功能得到扩展，添加了新的事件，而且几乎网页中的任何元素都可以作为放置目标。IE5.5更进一步，让网页中的任何元素都可以拖放。HTML5以IE的实例为基础制定了拖放规范。其他浏览器也根据HTML5规范实现了拖放功能。

## 媒体元素

随着音频和视频在Web上的迅速流行，大多数提供富媒体内容的站点为了保证跨浏览器兼容性，不得不选择使用Flash。HTML5新增了两个与媒体相关的标签，让开发人员不比依赖任何插件就能在网页中嵌入跨浏览器的音频和视频内容。这两个标签就是audio和video。

这两个标签除了能让开发人员方便地嵌入媒体文件之外，都提供了用于实现常用功能JavaScript API，允许为媒体创建自定义的控件。这两个元素的用法如下：

```
<!-- 嵌入视频 -->
<video src="conference.mpg" id="myVideo">Video player not available.</video>

<!--- 嵌入音频 -->
<audio src="song.mp3" id="myAudio"> Audio player not available.</audio>
``` 

使用者两个元素时，至少要在标签中包含src元素，指向要加载的媒体文件。还可以设置width和height属性以制定视频播放器的大小，而为poster属性置顶图像的URI可以在加载视频内容期间显示一幅图像。另外，如果标签中有controls属性，则以为着浏览器应该显示UI控件，以便用户直接操作媒体。位于开始标签和结束标签之间的任何内容都将作为后备内容，在浏览器不支持这两个媒体元素的情况下显示。

## 历史状态管理

历史状态管理师现代Web应用开发中的一个难点。在现代Web应用中，用户的每次操作不一定会打开一个全新的页面，因此后退和前进按钮也就失去了作用，导致用户很难在不同状态间切换。要解决这个问题，首选使用hashchange事件。HTML5通过更新history对象为管理历史状态提供了方便。

## 小结

HTML5除了定义了新的标记规则，还定义了一些JavaScript API。这些API是为了让开发人员创建出更好的、能够与桌面应用媲美的用户界面而设计的。

- 跨文档消息传递API能够让我们在不降低同源策略安全性的前提下，在来自不同域的文档间传递消息。
- 原生拖放功能让我们可以方便地制定某个元素可拖动，并在操作系统要放置时作出响应。还可以创建自定义的可拖动元素及放置目标。
- 新的媒体元素audio和video拥有自己的与音频和视频交互的API。并未所有浏览器支持所有的媒体格式，因此应该使用canPlayType检查浏览器是否支持特定格式。
- 历史状态管理让我们不必卸载当前页面即可修改浏览器的历史状态栈。有了这种机制，用户就可以通过后退和前进按钮在页面状态间切换，而这些状态完全由JavaScript进行控制。 
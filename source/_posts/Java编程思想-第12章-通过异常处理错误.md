---
title: Java编程思想 第12章 通过异常处理错误
date: 2017-11-27 22:37:47
tags: [读书笔记, Java编程思想]
---
> Java的基本理念是“结构不佳的代码不能运行”。

<!--more-->

## 概念

Java用强制规定的形式来消除错误处理过程中随心所欲的因素。这种做法由来已久，对异常处理的实现可以追溯到20世纪60年代的操作系统，甚至于BASIC语言中的on error goto语句。而C++的异常处理机制基于Ada，Java中的异常处理则建立在C++的基础之上。

## 基本异常

异常情形是指阻止当前方法或作用域继续执行的问题。把异常情形与普通问题相区分很重要，所谓的普通问题是指，在当前环境下能得到足够的信息，总能处理这个错误。而对于异常情形，就不能继续下去了，因为在当前环境下无法获得必要的信息来解决问题。

## 捕获异常

监控区域是一段可能产生异常的代码，并且后面跟着处理这些异常的代码。

- try块：如果在方法内部抛出了异常，这个方法将在抛出异常的过程中结束。要是不希望方法就此结束，可以在方法内设置一个特殊的块来捕获异常。因为在这个块里尝试各种方法调用，所以称为try块。
- 异常处理程序：抛出的异常必须在某处得到处理。这个地点就是异常处理程序，而且针对每个要捕获的异常，得准备相应的处理程序。异常处理程序紧跟在try块之后，以关键字catch表示。
- 终止与恢复：异常处理理论上由两种基本类型。Java支持终止模型。另一种称为恢复模型。最终程序员们都转向使用类似终止模型的代码，并且忽略恢复行为。所以虽然恢复模型开始显得吸引人，但不是很使用。

## 创建自定义异常

不必拘泥于Java中已有的异常类型。Java提供的异常体系不可能遇见所有的希望加以报告的错误，所以可以自己定义异常类来表示程序中可能会遇到的特定问题。要自己定义异常类，必须从已有的异常类继承，最好是选择意思相近的异常类继承。

## 异常说明

Java鼓励人们把方法可能会抛出的异常告知使用此方法的客户端程序员。这是种优雅的做法，它使得调用者能确切知道写什么样的代码可以捕获所有潜在的异常。Java提供了相应的语法，告知客户端程序员某个方法可能会抛出的异常类型。这就是异常说明，它属于方法声明的一部分，紧跟在形式参数列表之后。

## 捕获所有异常

可以只写一个异常处理程序来捕获所有类型的异常。通过捕获异常类型的基类Exception就可以做到这一点，事实上还有其他基类，但Exception是同编程活动相关的基类。

## Java标准异常

Throwable这个Java类被用来表示任何可以作为异常被抛出的类。Throwable对象可分为两种类型：Error用来表示编译时和系统错误；Exception是可以被抛出的基本类型，在Java类库、用户方法以及运行时故障中都可能抛出Exception型异常。所以Java程序员关心的基类型通常是Exception。

## 使用finally进行清理

对于一些代码，可能会希望无论try块中的异常是否抛出，它们都得到执行。这通常适合于内存回收之外的情况。为了达到这个效果，可以在异常处理程序后面加上finally子句。对于没有垃圾回收和析构函数自动调用机制的语言来说，finally非常重要。它能使程序员保证：无论try块里发生什么，内存总能得到释放。但Java有垃圾回收机制，所以内存释放不再是问题。所以finally的使用通常在要把除内存之外的资源恢复到它们的初始状态时。比如已经打开的文件或网络连接，在屏幕上画的图形，甚至可以是外部世界的某个开头。

## 异常的限制

当覆盖方法的时候，只能抛出在基类方法的异常说明里列出的那些异常。这个限制很有用，因为这意味着，当基类使用的代码应用到其派生类对象的时候，一样能够工作，异常也不例外。

## 构造器

构造器会把对象设置成安全的初始状态，但还会有别的动作，比如打开一个文件，这样的动作只有在对象使用完毕并且用户调用了特殊的清理方法之后才能得以清理。如果在构造器内部抛出了异常，这些清理行为也许就不能正常工作了。

## 异常匹配

抛出异常的时候，异常处理系统会按照代码的书写顺序找出最近的处理程序。找到匹配的处理程序之后，它就认为异常将得到处理，然后就不再继续查找。查找的时候并不要求抛出的异常同处理程序所声明的异常完全匹配。派生类的对象也可以匹配其基类的处理程序。

## 其他可选方式

异常处理程序就像一个活门，使你能放弃程序的正常执行序列。当异常情形发生的时候，正常的执行已变得不可能或者不需要了，这时就要用到这个活门。异常代表了当前方法不能继续执行的情形。开发异常处理系统的原因是，如果为每个方法所有可能发生的错误都进行处理的话，任务就显得过于繁重了，程序员也不愿意这么做。结果常常是将错误忽略。应该注意到，开发异常处理的初衷是为了方便程序员处理错误。

## 异常使用指南

应该在下列情况下使用异常：

1. 在恰当的级别处理问题。
2. 解决问题并且重新调用产生异常的方法。
3. 进行少许修补，然后绕过异常发生的地方继续执行。
4. 用别的数据进行计算，以代替方法预计会返回的值。
5. 把当前运行环境下能做的事情尽量做完，然后把相同的异常重抛到更高层。
6. 把当前运行环境下能做的事情尽量做完，然后把不同的异常抛到更高层。
7. 终止程序。
8. 进行简化。
9. 让类库和程序更安全。

## 总结

异常是Java程序设计不可分割的一部分，如果不了解如何使用它们，那只能完成很有限的工作。对于许多类库，如果不处理异常，就无法使用它们。
---
title: JS高程 第十九章 E4X
date: 2017-11-09 22:18:01
tags: [读书笔记, JavaScript高级程序设计]
---
> 在以BEA Systems为首的几家公司建议下，为ECMAScript添加一项扩张，增加原生的的XML支持。2004年6月，E4X(ECMAScript for XML) 以ECMA-357标准的形式发布。E4X本身不是一门语言，它只是ECMAScript语言的可选扩展。就其本身而言，E4X为处理XML定义了新的语法，也定义了特定于XML的对象。

<!--more-->

## E4X的类型

作为ECMAScript的扩展，E4X定义了如下几个全新的全局类型。

- XML：XML结构中的任何一个独立的部分，继承自Object。
- XMLList：XML对象的集合
- Namespace：命名空间前缀与命名空间URI组成的一个限定名
- QName：由内部名称和命名空间URI组成的一个限定名

E4X定义的这4个类型可以表现XML文档中的所有部分，其内部机制是将每一种类型都映射为多个DOM类型。

## 一般用法

在将XML对象、元素、特性和文本集合到一个层次化对象之后，就可以使用点号加特性或标签名的方式来访问其中不同的层次和结构。每个子元素都是父元素的一个属性，而属性名与元素的内部名称相同。如果子元素只包含文本，则相应的属性只返回文本。

## 其他变化

为了与ECMAScript做到无缝集成，E4X也对语言基础进行了一些修改。其中之一就是引入了for-each-in循环，以便迭代遍历每一个属性并返回属性的值。

E4X还添加了一个全局函数，名叫isXMLName。这个函数接受一个字符串，并在这个字符串是元素或特性的有效内部名称的情况下返回true。

## 全面启用E4X

鉴于E4X在很多方面给标准JavaScript带来不同，因此Firefox在默认情况下只启用E4X中与其他代码能够相安无事的那些特性。要想完整地启用E4X，需要将script标签type特性设置为"text/javascript;e4x=1"，例如：

```
<script type="text/javascript;e4x=1" src="e4x_file.js"></script>
```

在打开这个开关之后，就会全面启用E4X，从而能够正确地解析嵌入在E4X字面量中的注释和CData片段。在没有完整启用E4X的情况下就会导致语法错误。

## 小结

E4X是以ECMA-357标准的形式发布的对ECMAScript的一个扩展。E4X的目的是为操作XML数据提供与标准ECMAScript更相近的语法。E4X具有以下特性。

- 与DOM不同，E4X只用一个类型来表示XML中的各种节点
- XML对象中封装了对所有节点都有用的数据和行为
- 另外两个类型，Namespace和QName，分别表示命名空间和限定名

为便于查询XML结构，E4X还修改了标准的ECMAScript语法。

- 使用两个点表示匹配所有后代元素，使用@字符表示应该返回一或多个特性
- 星号字符是一个通配符，可以匹配任意类型的节点
- 所有这些查询都可以通过一组执行相同操作的方法来实现
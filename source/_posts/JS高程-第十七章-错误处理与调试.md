---
title: JS高程 第十七章 错误处理与调试
date: 2017-11-07 22:30:58
tags: [读书笔记, JavaScript高级程序设计]
---
> 由于JavaScript本身是动态语言，而且多年来一直没有固定的开发工具，因此人们普遍认为它是一种最难于调试的编程语言。当然，现在用来写JavaScript比较优秀的就是WebStorm。在当时，脚本出错时，浏览器通常会给出类似“object expected”这样的消息，没有说行细纹信息，让人摸不着头脑。ECMAScript第三版致力于解决这个问题。专门引入了try-catch和throw语句以及一些错误类型，已在让开发人员能够适当地处理错误。几年之后，Web浏览器中也出现了一些JavaScript调试程序和工具。在又了语言特性和工具支持之后，现在的开发人员已经能够适当地实现错误处理，并且能够找到错误的根源。

## 浏览器报告的错误

IE、Firefox、Safari、Chrome和Opera等主流浏览器，都具有某种向用户报告JavaScript错误的机制。默认情况下，所有浏览器都会隐藏此类信息，毕竟除了开发人员之外，很少有人关心这些内容。因此，在基于浏览器编写JavaScript脚本时，别忘了启用浏览器的JavaScript报告功能，以便及时收到错误通知。

## 错误处理

错误处理程序在程序设计中的重要性时毋庸置疑的。任何有影响力的Web应用程序都需要一套完善的错误处理机制，当然，大多数佼佼者确实做到了这一点，但通常只有服务器端应用程序才能做到如此。实际上，服务器端团队往往会在错误处理机制上投入较大的精力，通常要考虑按照类型、频率，或者其他重要的标准对错误进行分类。这样一来，开发人员就能够理解用户在使用简单数据库查询或者报告生成脚本时，应用程序可能出现的问题。

虽然客户端应用程序的错误处理也同样重要，但真正收到重视，还是最近几年的事。实际上，我们要面对这样一个不争的事实：使用Web的绝大多数人都不是技术高手，其中甚至有很多人根本就不明白浏览器到底是什么，更不用说让他们说喜欢哪一个了。

### try-catch语句

ECMA-262第3版引入了try-catch语句，作为JavaScript中处理异常的一种标准方式。如果try块中的任何代码发生了错误，就会立即退出代码执行过程，然后接着执行catch块。此时，catch块会接收到一个包含错误信息的对象。

- finally子句： 虽然在try-catch语句中是可选的，但finally子句已经使用，其代码无论如何都会执行。甚至return语句，都不会阻止finally子句的执行。
-  ECMA-262定义了7种错误类型：
>* Error: 基类型，其他类型都继承自该类型。因此，所有错误类型共享了一组相同的类型。
>* EvalError: 该类型的错误会在使用eval函数而发生异常时抛出。
>* RangeError: 该类型会在数值超出相应范围时触发。
>* ReferenceError: 在找不到对象的情况下，会抛出这个错误。
>* SyntaxError: 当把语法错误的JavaScript字符串传入eval函数时就会导致这个错误。
>* TypeError: 该类型在JavaScript中灰经常用到，在变量中保存着意外的类型或在访问不存在的方法时，都会导致这个错误。
>* URIError: 在使用encodeURI或decodeURI方法，而URI格式不正确时，就会导致这个错误。

### 区分致命错误和非致命错误

任何错误处理策略中最重要的一个部分，就是确定错误是否致命。对于非致命错误，可以根据下列一个或多个条件来确定：

- 不影响用户的主要任务
- 只影响页面的一部分
- 可以恢复
- 重复相同操作可以消除错误

## 调试技术

在不那么容易找到JavaScript调试程序的年代，开发人员不得不发挥自己的创造力，通过各种方法来调试自己的代码。结果，就出现了以这样或那样的方式置入代码，从而输出调试信息的做法。其中最常见的做法就是在要调试的代码中随处插入alert函数。但这种做法一方面比较麻烦，另一方面还可能引入新问题。

### 将消息记录到控制台

IE8,Firefox,Opera,Chrome和Safari都有JavaScirpt控制台，可以用来查看JavaScirpt错误。而且，这些浏览器中，都可以通过代码向控制台输出消息。可以通过console对象向JavaScript中写入消息，这个对象具有下列方法：

- error(message): 将错误消息记录到控制台
- info(message): 将信息性消息记录到控制台
- log(messge): 将一般消息记录到控制台
- warn(message): 将警告信息记录到控制台

### 将消息记录到当前页面

另一种输出调试信息的方式，就是在页面中开辟一小块区域，泳衣显示消息。这个区域通常是一个元素，而该元素可以总是出现在页面中，但仅用于调试目的；也可以根据需要动态创建的元素。

可以使用assert函数代替某些函数中需要调试的if语句，一遍输出错误消息。使用assert函数可以减少抛出错误所需的代码量，而且也比之前的方式易于理解。

## 常见的IE错误

- 操作终止
- 无效字符
- 未找到成员
- 未知运行错误
- 语法错误
- 系统无法找到制定资源

## 小结

错误处理对于如今复杂的Web应用程序开发至关重要。几种避免浏览器响应JavaScript错误的方法。

- 在可能发生错误的地方使用try-catch语句。
- 使用window.onerror事件处理程序，这种方式可以接受try-catch不能处理的所有错误。

另外对于任何Web应用程序都应该分析可能的错误来源，并制定处理错误的方案。

- 首先，必须要明确什么是致命错误，什么是非致命错误
- JavaScipt中发生错误的主要原因：类型转换，未充分检测数据类型，发送给服务器或从服务器接收到的数据有错误

现代浏览器都有JavaScript调试器，有的是内置的，有的是以需要下载的扩展形式存在的。这些调试器都支持设置断点、控制代码执行及在运行时检测变量的值。ps：现代模块化的前端编程，使用浏览器调试效果很差，需要特别的开发工具支持。